{% extends "base.html" %}

{% block title %}Risk Assessment - Enhanced Diabetes Predictor{% endblock %}
{% block nav_predict %}active{% endblock %}

{% block head %}
<style>
    .form-step {
        display: none;
    }
    .form-step.active {
        display: block;
    }
    .step-indicator {
        transition: all 0.3s ease;
    }
    .step-indicator.completed {
        background-color: #10B981;
        color: white;
    }
    .step-indicator.active {
        background-color: #3B82F6;
        color: white;
    }
    
    /* Ensure radio buttons don't trigger form submission */
    .radio-group {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }
    
    .radio-option {
        display: flex;
        align-items: center;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 0.5rem;
        transition: background-color 0.2s;
    }
    
    .radio-option:hover {
        background-color: #f3f4f6;
    }
    
    .radio-option input[type="radio"] {
        margin-right: 0.5rem;
        cursor: pointer;
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-4">Diabetes Risk Assessment</h1>
        <p class="text-lg text-gray-600">Complete this comprehensive assessment to understand your diabetes risk and receive personalized recommendations.</p>
    </div>

    <!-- Progress Indicator -->
    <div class="mb-8">
        <div class="flex justify-center space-x-8">
            <div class="flex items-center">
                <div class="step-indicator w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-sm font-medium" data-step="1">1</div>
                <span class="ml-2 text-sm font-medium text-gray-500">Personal Info</span>
            </div>
            <div class="flex items-center">
                <div class="step-indicator w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-sm font-medium" data-step="2">2</div>
                <span class="ml-2 text-sm font-medium text-gray-500">Medical History</span>
            </div>
            <div class="flex items-center">
                <div class="step-indicator w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-sm font-medium" data-step="3">3</div>
                <span class="ml-2 text-sm font-medium text-gray-500">Lab Values</span>
            </div>
            <div class="flex items-center">
                <div class="step-indicator w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-sm font-medium" data-step="4">4</div>
                <span class="ml-2 text-sm font-medium text-gray-500">Lifestyle</span>
            </div>
        </div>
        <div class="mt-4">
            <div class="w-full bg-gray-200 rounded-full h-2">
                <div id="progress-bar" class="bg-gradient-to-r from-blue-500 to-green-500 h-2 rounded-full transition-all duration-500" style="width: 25%"></div>
            </div>
        </div>
    </div>

    <!-- Form -->
    <form id="prediction-form" class="glassmorphism rounded-2xl p-8" onsubmit="return false;">
        <!-- Step 1: Personal Information -->
        <div class="form-step active" data-step="1">
            <h3 class="text-xl font-semibold text-gray-900 mb-6">Personal Information</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="age" class="block text-sm font-medium text-gray-700 mb-2">Age *</label>
                    <input type="number" id="age" name="age" min="18" max="120" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                    <div class="mt-1 text-xs text-gray-500">Enter your current age in years</div>
                </div>
                
                <div>
                    <label for="gender" class="block text-sm font-medium text-gray-700 mb-2">Gender *</label>
                    <select id="gender" name="gender" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                        <option value="">Select gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                    </select>
                </div>
                
                <div>
                    <label for="height" class="block text-sm font-medium text-gray-700 mb-2">Height (cm)</label>
                    <input type="number" id="height" name="height" min="100" max="250" step="0.1"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                    <div class="mt-1 text-xs text-gray-500">Enter your height in centimeters</div>
                </div>
                
                <div>
                    <label for="weight" class="block text-sm font-medium text-gray-700 mb-2">Weight (kg)</label>
                    <input type="number" id="weight" name="weight" min="30" max="300" step="0.1"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                    <div class="mt-1 text-xs text-gray-500">Enter your current weight in kilograms</div>
                </div>
                
                <div class="md:col-span-2">
                    <label for="bmi" class="block text-sm font-medium text-gray-700 mb-2">BMI *</label>
                    <div class="flex items-center space-x-4">
                        <input type="number" id="bmi" name="bmi" min="10" max="60" step="0.1" required
                               class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                        <button type="button" id="calculate-bmi" class="px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200">
                            Calculate BMI
                        </button>
                    </div>
                    <div class="mt-1 text-xs text-gray-500">Enter your BMI or calculate it using height and weight</div>
                    <div id="bmi-category" class="mt-2 text-sm font-medium"></div>
                </div>
            </div>
        </div>

        <!-- Step 2: Medical History -->
        <div class="form-step" data-step="2">
            <h3 class="text-xl font-semibold text-gray-900 mb-6">Medical History</h3>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-4">Do you have high blood pressure (hypertension)? *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="hypertension" value="1" required onclick="event.stopPropagation();">
                            <span>Yes</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="hypertension" value="0" required onclick="event.stopPropagation();">
                            <span>No</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="hypertension" value="0" required onclick="event.stopPropagation();">
                            <span>Don't know</span>
                        </label>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-4">Do you have heart disease? *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="heart_disease" value="1" required onclick="event.stopPropagation();">
                            <span>Yes</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="heart_disease" value="0" required onclick="event.stopPropagation();">
                            <span>No</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="heart_disease" value="0" required onclick="event.stopPropagation();">
                            <span>Don't know</span>
                        </label>
                    </div>
                </div>
                
                <div>
                    <label for="family_history" class="block text-sm font-medium text-gray-700 mb-2">Family History of Diabetes</label>
                    <select id="family_history" name="family_history"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                        <option value="">Select option</option>
                        <option value="none">No family history</option>
                        <option value="parent">Parent with diabetes</option>
                        <option value="sibling">Sibling with diabetes</option>
                        <option value="multiple">Multiple family members</option>
                    </select>
                </div>
                
                <div>
                    <label for="medications" class="block text-sm font-medium text-gray-700 mb-2">Current Medications</label>
                    <textarea id="medications" name="medications" rows="3"
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                              placeholder="List any medications you're currently taking (optional)"></textarea>
                </div>
            </div>
        </div>

        <!-- Step 3: Laboratory Values -->
        <div class="form-step" data-step="3">
            <h3 class="text-xl font-semibold text-gray-900 mb-6">Laboratory Values</h3>
            
            <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <span class="text-blue-400 text-xl">‚ÑπÔ∏è</span>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm text-blue-700">
                            If you don't have recent lab results, you can skip these fields or use approximate values from your last checkup.
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="hba1c_level" class="block text-sm font-medium text-gray-700 mb-2">HbA1c Level (%)</label>
                    <input type="number" id="hba1c_level" name="hba1c_level" min="3" max="20" step="0.1"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                    <div class="mt-1 text-xs text-gray-500">Normal: &lt; 5.7%, Pre-diabetes: 5.7-6.4%, Diabetes: ‚â• 6.5%</div>
                </div>
                
                <div>
                    <label for="blood_glucose_level" class="block text-sm font-medium text-gray-700 mb-2">Blood Glucose (mg/dL)</label>
                    <input type="number" id="blood_glucose_level" name="blood_glucose_level" min="50" max="500"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                    <div class="mt-1 text-xs text-gray-500">Fasting: Normal &lt; 100, Pre-diabetes: 100-125, Diabetes: ‚â• 126</div>
                </div>
                
                <div>
                    <label for="cholesterol" class="block text-sm font-medium text-gray-700 mb-2">Total Cholesterol (mg/dL)</label>
                    <input type="number" id="cholesterol" name="cholesterol" min="100" max="500"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                    <div class="mt-1 text-xs text-gray-500">Desirable: &lt; 200, Borderline: 200-239, High: ‚â• 240</div>
                </div>
                
                <div>
                    <label for="blood_pressure" class="block text-sm font-medium text-gray-700 mb-2">Blood Pressure (systolic)</label>
                    <input type="number" id="blood_pressure" name="blood_pressure" min="80" max="200"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                    <div class="mt-1 text-xs text-gray-500">Normal: &lt; 120, Elevated: 120-129, High: ‚â• 130</div>
                </div>
            </div>
        </div>

        <!-- Step 4: Lifestyle Factors -->
        <div class="form-step" data-step="4">
            <h3 class="text-xl font-semibold text-gray-900 mb-6">Lifestyle Factors</h3>
            
            <div class="space-y-6">
                <div>
                    <label for="smoking_history" class="block text-sm font-medium text-gray-700 mb-2">Smoking History *</label>
                    <select id="smoking_history" name="smoking_history" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                        <option value="">Select smoking history</option>
                        <option value="never">Never smoked</option>
                        <option value="former">Former smoker</option>
                        <option value="current">Current smoker</option>
                    </select>
                </div>
                
                <div>
                    <label for="physical_activity" class="block text-sm font-medium text-gray-700 mb-2">Physical Activity Level</label>
                    <select id="physical_activity" name="physical_activity"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                        <option value="">Select activity level</option>
                        <option value="sedentary">Sedentary (little to no exercise)</option>
                        <option value="lightly_active">Lightly active (light exercise 1-3 days/week)</option>
                        <option value="moderately_active">Moderately active (moderate exercise 3-5 days/week)</option>
                        <option value="very_active">Very active (hard exercise 6-7 days/week)</option>
                        <option value="extremely_active">Extremely active (very hard exercise, physical job)</option>
                    </select>
                </div>
                
                <div>
                    <label for="diet_quality" class="block text-sm font-medium text-gray-700 mb-2">Diet Quality</label>
                    <select id="diet_quality" name="diet_quality"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                        <option value="">Select diet quality</option>
                        <option value="poor">Poor (high processed foods, low vegetables)</option>
                        <option value="fair">Fair (some healthy foods, occasional processed foods)</option>
                        <option value="good">Good (mostly healthy foods, limited processed foods)</option>
                        <option value="excellent">Excellent (whole foods, Mediterranean-style diet)</option>
                    </select>
                </div>
                
                <div>
                    <label for="sleep_hours" class="block text-sm font-medium text-gray-700 mb-2">Average Sleep Hours per Night</label>
                    <input type="number" id="sleep_hours" name="sleep_hours" min="3" max="12" step="0.5"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                    <div class="mt-1 text-xs text-gray-500">Recommended: 7-9 hours per night</div>
                </div>
                
                <div>
                    <label for="stress_level" class="block text-sm font-medium text-gray-700 mb-2">Stress Level (1-10 scale)</label>
                    <input type="range" id="stress_level" name="stress_level" min="1" max="10" value="5"
                           class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>1 (Low stress)</span>
                        <span id="stress_level_display">5</span>
                        <span>10 (High stress)</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="flex justify-between mt-8 pt-8 border-t border-gray-200">
            <button type="button" id="prev-btn" class="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors duration-200 hidden">
                Previous
            </button>
            <div class="flex space-x-4">
                <button type="button" id="next-btn" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200">
                    Next Step
                </button>
                <button type="button" id="submit-btn" class="hidden px-8 py-3 bg-gradient-to-r from-green-600 to-blue-600 text-white rounded-lg hover:from-green-700 hover:to-blue-700 transition-all duration-200 transform hover:scale-105">
                    Get My Risk Assessment
                </button>
            </div>
        </div>
    </form>

    <!-- Results Section (initially hidden) -->
    <div id="results-section" class="hidden mt-8">
        <div class="glassmorphism rounded-2xl p-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Your Diabetes Risk Assessment Results</h2>
            <div id="results-content">
                <!-- Results will be populated here -->
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/form-wizard.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize form wizard
    const formWizard = new FormWizard('prediction-form');
    
    // Prevent radio buttons from causing form submission or navigation
    const radioButtons = document.querySelectorAll('input[type="radio"]');
    radioButtons.forEach(radio => {
        radio.addEventListener('click', function(e) {
            e.stopPropagation();
            e.stopImmediatePropagation();
        });
        
        radio.addEventListener('change', function(e) {
            e.stopPropagation();
            e.stopImmediatePropagation();
        });
    });
    
    // BMI calculation
    document.getElementById('calculate-bmi').addEventListener('click', function(e) {
        e.preventDefault();
        const height = parseFloat(document.getElementById('height').value);
        const weight = parseFloat(document.getElementById('weight').value);
        
        if (height && weight) {
            const bmi = weight / Math.pow(height / 100, 2);
            document.getElementById('bmi').value = bmi.toFixed(1);
            updateBMICategory(bmi);
        } else {
            showToast('Please enter both height and weight to calculate BMI', 'warning');
        }
    });
    
    // Auto-update BMI when height or weight changes
    document.getElementById('height').addEventListener('input', autocalculateBMI);
    document.getElementById('weight').addEventListener('input', autocalculateBMI);
    document.getElementById('bmi').addEventListener('input', function() {
        const bmi = parseFloat(this.value);
        if (bmi) {
            updateBMICategory(bmi);
        }
    });
    
    // Update stress level display
    document.getElementById('stress_level').addEventListener('input', function() {
        document.getElementById('stress_level_display').textContent = this.value;
    });
    
    // Form submission - prevent default form submission
    document.getElementById('prediction-form').addEventListener('submit', function(e) {
        e.preventDefault();
        return false;
    });
    
    // Submit button click handler
    document.getElementById('submit-btn').addEventListener('click', async function(e) {
        e.preventDefault();
        await submitPredictionForm();
    });
});

function autocalculateBMI() {
    const height = parseFloat(document.getElementById('height').value);
    const weight = parseFloat(document.getElementById('weight').value);
    
    if (height && weight && height > 50 && weight > 20) {
        const bmi = weight / Math.pow(height / 100, 2);
        document.getElementById('bmi').value = bmi.toFixed(1);
        updateBMICategory(bmi);
    }
}

function updateBMICategory(bmi) {
    const categoryElement = document.getElementById('bmi-category');
    let category, color;
    
    if (bmi < 18.5) {
        category = 'Underweight';
        color = 'text-blue-600';
    } else if (bmi < 25) {
        category = 'Normal weight';
        color = 'text-green-600';
    } else if (bmi < 30) {
        category = 'Overweight';
        color = 'text-yellow-600';
    } else if (bmi < 35) {
        category = 'Obesity Class I';
        color = 'text-orange-600';
    } else {
        category = 'Obesity Class II+';
        color = 'text-red-600';
    }
    
    categoryElement.innerHTML = `<span class="${color}">BMI Category: ${category}</span>`;
}

async function submitPredictionForm() {
    try {
        showLoading(true);
        
        // Collect form data
        const formData = new FormData(document.getElementById('prediction-form'));
        const data = {};
        
        for (let [key, value] of formData.entries()) {
            // Convert numeric fields
            if (['age', 'height', 'weight', 'bmi', 'hba1c_level', 'blood_glucose_level', 
                 'cholesterol', 'blood_pressure', 'sleep_hours', 'stress_level'].includes(key)) {
                data[key] = parseFloat(value) || 0;
            }
            // Convert boolean fields
            else if (['hypertension', 'heart_disease'].includes(key)) {
                data[key] = parseInt(value) === 1;
            }
            else {
                data[key] = value;
            }
        }
        
        // Validate required fields
        const requiredFields = ['age', 'gender', 'bmi'];
        const missingFields = requiredFields.filter(field => !data[field]);
        
        if (missingFields.length > 0) {
            showToast(`Please fill in required fields: ${missingFields.join(', ')}`, 'error');
            return;
        }
        
        // Make prediction request
        const api = new APIClient();
        const results = await api.predict(data);
        
        // Display results
        displayResults(results);
        
        // Hide form and show results
        document.getElementById('prediction-form').style.display = 'none';
        document.getElementById('results-section').classList.remove('hidden');
        
        // Scroll to results
        document.getElementById('results-section').scrollIntoView({ 
            behavior: 'smooth' 
        });
        
        showToast('Risk assessment completed successfully!', 'success');
        
    } catch (error) {
        console.error('Prediction error:', error);
        showToast('Failed to complete risk assessment. Please try again.', 'error');
    } finally {
        showLoading(false);
    }
}

function displayResults(results) {
    const resultsContent = document.getElementById('results-content');
    const primaryPrediction = results.primary_prediction;
    const riskAnalysis = results.risk_analysis;
    const recommendations = results.recommendations;
    
    // Risk level color mapping
    const riskColors = {
        'low': 'text-green-600 bg-green-50 border-green-200',
        'moderate': 'text-yellow-600 bg-yellow-50 border-yellow-200',
        'high': 'text-orange-600 bg-orange-50 border-orange-200',
        'very_high': 'text-red-600 bg-red-50 border-red-200'
    };
    
    const riskColor = riskColors[primaryPrediction.risk_level] || 'text-gray-600 bg-gray-50 border-gray-200';
    
    resultsContent.innerHTML = `
        <!-- Primary Risk Result -->
        <div class="mb-8 p-6 border-2 rounded-xl ${riskColor}">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-bold">Your Diabetes Risk Level</h3>
                <span class="text-3xl font-bold">${(primaryPrediction.probability * 100).toFixed(1)}%</span>
            </div>
            <div class="text-lg font-semibold mb-2">${primaryPrediction.risk_level.toUpperCase()} RISK</div>
            <p class="text-sm">${results.summary || ''}</p>
        </div>
        
        <!-- Model Comparisons -->
        <div class="mb-8">
            <h4 class="text-lg font-semibold text-gray-900 mb-4">Model Predictions Comparison</h4>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                ${Object.entries(results.all_predictions).map(([model, prediction]) => `
                    <div class="bg-white border border-gray-200 rounded-lg p-4">
                        <h5 class="font-medium text-gray-900 mb-2">${model.replace('_', ' ').toUpperCase()}</h5>
                        <div class="text-2xl font-bold text-blue-600 mb-1">${(prediction.probability * 100).toFixed(1)}%</div>
                        <div class="text-sm text-gray-600">${prediction.risk_level}</div>
                        <div class="mt-2 text-xs text-gray-500">
                            Confidence: ${(prediction.confidence_interval[0] * 100).toFixed(1)}% - ${(prediction.confidence_interval[1] * 100).toFixed(1)}%
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
        
        <!-- Risk Factors Analysis -->
        ${riskAnalysis && riskAnalysis.individual_factors ? `
        <div class="mb-8">
            <h4 class="text-lg font-semibold text-gray-900 mb-4">Risk Factors Analysis</h4>
            <div class="space-y-3">
                ${Object.entries(riskAnalysis.individual_factors).map(([factor, analysis]) => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center">
                            <span class="w-3 h-3 rounded-full mr-3 ${
                                analysis.severity === 'low' ? 'bg-green-400' :
                                analysis.severity === 'moderate' ? 'bg-yellow-400' :
                                analysis.severity === 'high' ? 'bg-orange-400' : 'bg-red-400'
                            }"></span>
                            <span class="font-medium">${factor.replace('_', ' ').toUpperCase()}</span>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-medium">${analysis.severity}</div>
                            <div class="text-xs text-gray-500">${(analysis.weighted_contribution * 100).toFixed(1)}% contribution</div>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
        ` : ''}
        
        <!-- Recommendations -->
        ${recommendations && recommendations.length > 0 ? `
        <div class="mb-8">
            <h4 class="text-lg font-semibold text-gray-900 mb-4">Personalized Recommendations</h4>
            <div class="space-y-4">
                ${recommendations.map(rec => `
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded">
                        <h5 class="font-semibold text-blue-900 mb-2">${rec.title}</h5>
                        <p class="text-blue-800 text-sm mb-3">${rec.description}</p>
                        ${rec.action_items ? `
                        <ul class="list-disc list-inside text-sm text-blue-700 space-y-1">
                            ${rec.action_items.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                        ` : ''}
                    </div>
                `).join('')}
            </div>
        </div>
        ` : ''}
        
        <!-- Next Steps -->
        <div class="bg-gradient-to-r from-blue-50 to-green-50 p-6 rounded-xl">
            <h4 class="text-lg font-semibold text-gray-900 mb-4">üéØ Next Steps</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button onclick="showHealthTasks()" class="p-4 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition-colors duration-200">
                    <div class="text-2xl mb-2">üìã</div>
                    <div class="font-medium text-gray-900">Start Health Tracking</div>
                    <div class="text-sm text-gray-600">Track daily health goals</div>
                </button>
                
                <button onclick="showAIChat()" class="p-4 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition-colors duration-200">
                    <div class="text-2xl mb-2">ü§ñ</div>
                    <div class="font-medium text-gray-900">Ask AI Assistant</div>
                    <div class="text-sm text-gray-600">Get personalized guidance</div>
                </button>
                
                <button onclick="window.location.href='/'" class="p-4 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition-colors duration-200">
                    <div class="text-2xl mb-2">üìä</div>
                    <div class="font-medium text-gray-900">View Dashboard</div>
                    <div class="text-sm text-gray-600">See your health overview</div>
                </button>
                
                <button onclick="window.print()" class="p-4 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition-colors duration-200">
                    <div class="text-2xl mb-2">üñ®Ô∏è</div>
                    <div class="font-medium text-gray-900">Print Results</div>
                    <div class="text-sm text-gray-600">Save for your records</div>
                </button>
            </div>
        </div>
        
        <!-- Medical Disclaimer -->
        <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
            <div class="flex">
                <div class="flex-shrink-0">
                    <span class="text-yellow-400 text-xl">‚ö†Ô∏è</span>
                </div>
                <div class="ml-3">
                    <h5 class="text-sm font-medium text-yellow-800">Important Medical Disclaimer</h5>
                    <p class="mt-1 text-sm text-yellow-700">
                        This assessment is for informational purposes only and should not replace professional medical advice. 
                        Please consult with a healthcare provider for proper diagnosis and treatment recommendations.
                    </p>
                </div>
            </div>
        </div>
    `;
}
</script>
{% endblock %}
